<Window x:Class="GB_Live.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:this="clr-namespace:GB_Live;assembly="
        xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        KeyDown="Window_KeyDown">
    
    <Window.Resources>
        
        <CollectionViewSource Source="{Binding Path=Events}"
                              x:Key="sortEventsByTime"
                              IsLiveSortingRequested="True">
            <CollectionViewSource.SortDescriptions>
                <scm:SortDescription PropertyName="Time" Direction="Ascending" />
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>
        
        <DataTemplate DataType="{x:Type this:GBUpcomingEvent}">
            
            <DataTemplate.Resources>
                <this:AddSpacesToEnumConverter x:Key="addSpacesToEnumConverter" />
                <this:FormatDateTimeString x:Key="formatDateTimeString" />
            </DataTemplate.Resources>

            <Grid>

                <Grid.RowDefinitions>
                    <RowDefinition Height="55" />
                    <RowDefinition Height="55" />
                </Grid.RowDefinitions>
                
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="180" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                
                <Image Source="{Binding Path=BackgroundImageUrl, Mode=OneTime}"
                       Grid.ColumnSpan="2"
                       Grid.RowSpan="2" />
                
                <Label Content="{Binding Path=Title, Mode=OneTime}"
                       Style="{StaticResource ResourceKey=LabelBase}"
                       VerticalContentAlignment="Bottom"
                       Grid.ColumnSpan="2"
                       Grid.Row="0" />

                <Label Content="{Binding Path=EventType, Mode=OneTime, Converter={StaticResource addSpacesToEnumConverter}}"
                       Style="{StaticResource ResourceKey=LabelBase}"
                       VerticalContentAlignment="Top"
                       Grid.Column="0"
                       Grid.Row="1" />
                
                <Label Content="{Binding Path=Time, Mode=OneTime, Converter={StaticResource formatDateTimeString}}"
                       Style="{StaticResource ResourceKey=LabelBase}"
                       VerticalContentAlignment="Top"
                       Grid.Column="1"
                       Grid.Row="1" />

            </Grid>
            
        </DataTemplate>
        
    </Window.Resources>
    
    <ItemsControl ItemsSource="{Binding Source={StaticResource sortEventsByTime}}">
        
        <ItemsControl.Template>
            <ControlTemplate>
                <ItemsPresenter />
            </ControlTemplate>
        </ItemsControl.Template>
        
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <StackPanel />
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        
    </ItemsControl>
</Window>
