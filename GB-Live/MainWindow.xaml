<Window x:Class="GB_Live.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:this="clr-namespace:GB_Live;assembly="
        xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        KeyDown="Window_KeyDown"
        Title="GB Live"
        WindowStyle="ThreeDBorderWindow"
        Background="Black"
        ResizeMode="CanMinimize"
        SizeToContent="Height" Width="450">
    
    <Window.Resources>
        
        <CollectionViewSource Source="{Binding Path=Events}"
                              x:Key="sortEventsByTime"
                              IsLiveSortingRequested="True">
            <CollectionViewSource.SortDescriptions>
                <scm:SortDescription PropertyName="Time" Direction="Ascending" />
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>
        
        <DataTemplate DataType="{x:Type this:GBUpcomingEvent}">
            
            <DataTemplate.Resources>
                
                <Style TargetType="{x:Type Label}">
                    <Setter Property="FontSize" Value="18" />
                    <Setter Property="FontWeight" Value="SemiBold" />
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="Foreground" Value="LightGray" />
                    <Setter Property="Height" Value="30" />
                    <!--<Setter Property="VerticalAlignment" Value="Stretch" />-->
                    <Setter Property="VerticalContentAlignment" Value="Center" />
                    <Setter Property="Width" Value="Auto" />
                    <Setter Property="HorizontalAlignment" Value="Stretch" />
                    <Setter Property="HorizontalContentAlignment" Value="Center" />
                </Style>

                <Style TargetType="{x:Type Image}">
                    <Setter Property="Opacity" Value="0.3" />
                    <Setter Property="Height" Value="Auto" />
                    <Setter Property="VerticalAlignment" Value="Center" />
                    <Setter Property="Width" Value="Auto" />
                    <Setter Property="HorizontalAlignment" Value="Center" />
                    <Setter Property="Stretch" Value="UniformToFill" />
                </Style>
                
                <this:AddSpacesToEnumConverter x:Key="addSpacesToEnumConverter" />
                
            </DataTemplate.Resources>
            
            <Canvas Width="450"
                    Height="100"
                    ClipToBounds="True"
                    VerticalAlignment="Stretch">
                
                <Image Canvas.Top="0"
                       Canvas.Left="0"
                       Panel.ZIndex="0"
                       SizeChanged="Image_SizeChanged"
                       ImageFailed="Image_ImageFailed"
                       Source="{Binding Path=BackgroundImageUrl}" />
                
                <Label Canvas.Top="15"
                       Canvas.Left="15"
                       Panel.ZIndex="1"
                       Content="{Binding Path=Title}" />
                
                <Label Canvas.Top="55"
                       Canvas.Left="15"
                       Panel.ZIndex="1"
                       Content="{Binding Path=EventType, Converter={StaticResource addSpacesToEnumConverter}}" />
                
                <Label Canvas.Top="55"
                       Canvas.Left="140"
                       Panel.ZIndex="1"
                       Content="{Binding Path=Time}" />
                
            </Canvas>
            
        </DataTemplate>
        
    </Window.Resources>
    
    <ItemsControl ItemsSource="{Binding Source={StaticResource sortEventsByTime}}">
        
        <ItemsControl.Template>
            <ControlTemplate>
                <ItemsPresenter />
            </ControlTemplate>
        </ItemsControl.Template>
        
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <StackPanel />
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        
    </ItemsControl>
</Window>
